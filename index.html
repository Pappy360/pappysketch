<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PappySketch Interactive Masonry</title>
<style>
  body {
    margin: 0;
    padding: 0;
    font-family: Arial, sans-serif;
    background: #f5f5f5;
  }

  header {
    text-align: center;
    padding: 20px;
    background: #4CAF50;
    color: white;
  }

  header h1 {
    margin: 0;
    font-size: 2em;
  }

  header p {
    margin: 5px 0 0 0;
    font-style: italic;
  }

  #upload {
    position: fixed;
    top: 10px;
    left: 10px;
    z-index: 1000;
    opacity: 0.9;
    padding: 5px;
    border: 1px solid #ccc;
    background: white;
    cursor: pointer;
  }

  .gallery {
    margin: 20px;
  }

  .gallery img {
    width: 200px;
    margin-bottom: 10px;
    cursor: grab;
    user-select: none;
    float: left; /* required for Masonry layout */
  }

  .dragging {
    opacity: 0.7;
    position: absolute;
    z-index: 10000;
    pointer-events: none;
  }

  @media (max-width: 900px) {
    .gallery img { width: 150px; }
  }

  @media (max-width: 600px) {
    .gallery img { width: 100%; }
  }
</style>
</head>
<body>

<header>
  <h1>PappySketch Gallery</h1>
  <p>Learn • Earn • Return</p>
</header>

<input type="file" id="upload" multiple>
<div class="gallery" id="gallery"></div>

<!-- Masonry.js CDN -->
<script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>

<script>
const upload = document.getElementById('upload');
const gallery = document.getElementById('gallery');

let msnry;

// Initialize Masonry
function initMasonry() {
  msnry = new Masonry(gallery, {
    itemSelector: 'img',
    columnWidth: 200,
    gutter: 10,
    transitionDuration: '0.3s'
  });
}

// Drag & drop variables
let draggedImg = null;
let offsetX = 0;
let offsetY = 0;

upload.addEventListener('change', function(e) {
  Array.from(e.target.files).forEach(file => {
    const reader = new FileReader();
    reader.onload = function(evt) {
      const img = document.createElement('img');
      img.src = evt.target.result;
      img.draggable = false;
      gallery.appendChild(img);

      img.onload = () => {
        if (!msnry) initMasonry();
        else msnry.appended(img);
      }

      img.addEventListener('mousedown', startDrag);
      img.addEventListener('touchstart', startDrag);
    }
    reader.readAsDataURL(file);
  });
});

// Drag functions
function startDrag(e) {
  e.preventDefault();
  draggedImg = e.target;

  const rect = draggedImg.getBoundingClientRect();
  const pageX = e.touches ? e.touches[0].pageX : e.pageX;
  const pageY = e.touches ? e.touches[0].pageY : e.pageY;

  offsetX = pageX - rect.left;
  offsetY = pageY - rect.top;

  draggedImg.classList.add('dragging');
  draggedImg.style.width = rect.width + 'px';
  draggedImg.style.height = rect.height + 'px';

  window.addEventListener('mousemove', drag);
  window.addEventListener('mouseup', drop);
  window.addEventListener('touchmove', drag);
  window.addEventListener('touchend', drop);
}

function drag(e) {
  if (!draggedImg) return;
  const pageX = e.touches ? e.touches[0].pageX : e.pageX;
  const pageY = e.touches ? e.touches[0].pageY : e.pageY;
  draggedImg.style.left = (pageX - offsetX) + 'px';
  draggedImg.style.top = (pageY - offsetY) + 'px';
}

function drop() {
  if (!draggedImg) return;

  draggedImg.classList.remove('dragging');
  draggedImg.style.position = '';
  draggedImg.style.left = '';
  draggedImg.style.top = '';

  // Re-layout Masonry after drop
  msnry.layout();

  draggedImg = null;
  window.removeEventListener('mousemove', drag);
  window.removeEventListener('mouseup', drop);
  window.removeEventListener('touchmove', drag);
  window.removeEventListener('touchend', drop);
}
</script>

</body>
</html>

